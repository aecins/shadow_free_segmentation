%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This is a demo of the image density map transformation presented in:
%   A. Ecins, C. Ferm√ºller, and Y.Aloimonos, "Shadow Free Segmentation in
%   Still Images using Local Density Measure", ICCP 2014
%
% ----------------
% Aleksandrs Ecins
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Clear and close
close all
clear all

%% Read image
im = imread('./im_gray.png');
im = im2double(im);

%% Compute density
imDensity = density(im, 2:5);

%% Show results
imDensityVis = histeq(mat2gray(imDensity),20);             % Rescale density to [0, 1] range and contrast normalize
figure;
subplot(2,1,1);
imshow(im);
subplot(2




% %% Prepare image
% 
% 
% 
% % Read image
% imName = 'dog_n_elephant';
% im = imread(['Images/', imName, '.jpg']);
% im = im2double(im);
% 
% % Choose fixation point
% fig_select_fixation = figure;
% imshow(im);
% title('Select a fixation point inside the object');
% [fix_x, fix_y] = ginput(1);
% fix_x = round(fix_x);
% fix_y = round(fix_y);
% close(fig_select_fixation);
% 
% %% Segment
% % [edgeGrad, ~]   = pbCGTG(im);                                               % Compute Berkeley edges
% load(['Images/', imName '_grad.mat']);                                      % Use precomputed Berkeley edges
% [labels, ~, ~] = segment(im, edgeGrad, fix_x, fix_y);                       % Segment
% 
% %% Show segmentation results
% segBoundary = bwmorph(labels==1, 'remove');
% segBoundary = bwmorph(segBoundary, 'dilate');
% segOrig     = imRegionHighlight(im, segBoundary == 1, 'g');
% 
% figure;
% imshow(segOrig);
% title('Segmented image');